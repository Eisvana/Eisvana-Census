import{W as U,d as P,D as S,c,o,t as m,e as w,X as T,Y as V,r as f,M as A,p as H,q as K,x as Q,y as X,a as e,L,w as B,m as h,F as R,B as N,g as W,R as Z,H as G,C as ee,_ as M,Z as te,s as F,$ as se,j as $,I as ne,a0 as ae,i as le,a1 as oe,a2 as D,a3 as re,a4 as ie}from"./main-Dks2u-ca.js";import{R as ue,b as de,t as ve,P as ce}from"./Pagination-QdfEBLHe.js";import{a as pe,l as q}from"./censusSubmission-D_wKqNg-.js";import{a as me}from"./delay-Ddkq_lkP.js";function ye(e){const a=e.slice(1,-1).split(" ");return{link:a[0],text:a.slice(1).join(" ")}}function fe(e){const a=e.slice(2,-2).split("|");return{link:`${U}${a[0]}`,text:a[1]}}function ge(e){return e.startsWith("[http")?ye(e):e.startsWith("[[")?fe(e):{link:e,text:e}}const Ce=["href"],E=P({__name:"LinkItem",props:{wikitext:{},text:{}},setup(e){const a=e,t=S((()=>a.wikitext.startsWith("[")?ge(a.wikitext):{text:a.wikitext,link:`${U}${a.wikitext}`}));return(e,a)=>(o(),c("a",{href:t.value.link,rel:"noopener noreferrer",target:"_blank"},m(e.text??t.value.text),9,Ce))}}),he=["href"],j=P({__name:"NewBaseButton",props:{text:{},entry:{}},setup:e=>(e,a)=>(o(),c("a",{href:`./form.html?new=${w(V)(e.entry.CensusPlayer)}`,role:"button",onClick:a[0]||(a[0]=a=>w(T)(e.entry))},m(e.text),9,he))}),we={class:"text-bold"},be={key:0,class:"text-center"},ke={class:"base-item"},Se=["for","aria-disabled"],Re=["disabled","id","value"],_e=["href"],$e={key:3},Be=P({__name:"ChangeCensusBase",props:{entry:{},items:{},requested:{}},emits:["close","ready","submit"],setup(a,{emit:t}){const l=a,s=S((()=>l.requested===l.entry.Name?"":l.requested)),n=S((()=>l.requested??l.entry.Name)),u=f(l.items??[]),r=f(!1),i=f(n.value),d=f(""),v=t;function y(){i.value!==n.value&&(v("submit",i.value),pe(l.entry,i.value,d.value))}return A((async()=>{if(!u.value.length)try{const e=await H(K(l.entry.CensusPlayer,Q));if(!X(e))return void(r.value=!0);u.value=e.cargoquery.map((e=>e.title.Name)),v("ready",u.value),r.value=!1}catch(e){r.value=!0,console.error("Something went wrong:",e)}})),(a,t)=>(o(),c("article",null,[e("header",we,[t[3]||(t[3]=e("button",{"aria-label":"Close",class:"close",form:"request-close-form"},null,-1)),e("p",null,"Change Census Base for "+m(a.entry.CensusPlayer),1)]),1===u.value.length?(o(),c("div",be,[t[4]||(t[4]=e("p",null,"There's currently only one base on the wiki.",-1)),h(j,{entry:a.entry,text:"Create New Base"},null,8,["entry"])])):u.value.length?(o(),c(R,{key:1},[(o(!0),c(R,null,N(u.value,(a=>(o(),c("div",ke,[e("label",{for:a,"aria-disabled":a===s.value||a===n.value&&!s.value,class:"base-selector"},[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),disabled:a===s.value||a===n.value&&!s.value,id:a,value:a,name:"bases",type:"radio"},null,8,Re),[[ee,i.value]]),e("span",null,m(a)+" "+m(a===s.value?"[Requested]":"")+" "+m(a!==n.value||s.value?"":"[Active]"),1)],8,Se),e("a",{href:w(me)(a),rel:"noopener noreferrer",target:"_blank"},"View Wiki Page",8,_e)])))),256)),B(e("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),"aria-label":"Reason (optional)",class:"reason-input",placeholder:"Reason (optional)",type:"text"},null,512),[[W,d.value]])],64)):r.value?(o(),c("p",$e,"Something went wrong!")):(o(),L(Z,{key:2})),B(e("footer",null,[e("form",{id:"request-close-form",method:"dialog",onSubmit:t[2]||(t[2]=e=>a.$emit("close"))},[e("button",{onClick:y},"Submit"),t[5]||(t[5]=e("button",{class:"secondary"},"Cancel",-1))],32)],512),[[G,u.value.length>1]])]))}}),Pe=M(Be,[["__scopeId","data-v-39f3fe2d"]]),xe={class:"census-item"},qe={class:"player-name text-bold"},Ne={class:"table-items"},Le={key:0},Me={key:1},Ie={class:"link is-social"},De={key:2},Ee={class:"friend-code"},Ue={class:"link"},Te={class:"action-buttons"},Ve=["href"],Ae=P({__name:"CensusItem",props:{entry:{}},setup(a){const t=a,l=localStorage.getItem(q)??"{}",s=JSON.parse(l),n=f(s[t.entry.CensusPlayer]);n.value===t.entry.Name&&(delete s[t.entry.CensusPlayer],localStorage.setItem(q,JSON.stringify(s)));const u=f(null),r=f(!1),i=te(),{triesExceeded:d}=F(i),v=S((()=>t.entry.renewed?"Already renewed":t.entry.renewRequested?"Renewal Requested":d.value?"Too Many Requests":`Request Renewal for ${se}`)),y=()=>{de(),r.value=!0,u.value?.showModal()},p=()=>{u.value?.close(),r.value=!1},C=f(),g=e=>C.value=e;function b(e){n.value=e,s[t.entry.CensusPlayer]=e,localStorage.setItem(q,JSON.stringify(s))}return(a,t)=>(o(),c(R,null,[e("article",xe,[e("p",qe,m(a.entry.CensusPlayer),1),e("div",Ne,[a.entry.CensusDiscord?(o(),c("div",Le,[t[1]||(t[1]=e("div",{class:"heading"},"Discord:",-1)),e("div",null,m(a.entry.CensusDiscord),1)])):$("",!0),a.entry.CensusReddit?(o(),c("div",Me,[t[2]||(t[2]=e("div",{class:"heading"},"Social Media:",-1)),e("div",Ie,[h(E,{wikitext:a.entry.CensusReddit},null,8,["wikitext"])])])):$("",!0),a.entry.CensusFriend?(o(),c("div",De,[t[3]||(t[3]=e("div",{class:"heading"},"Friend Code:",-1)),e("div",Ee,m(a.entry.CensusFriend),1)])):$("",!0),e("div",null,[t[4]||(t[4]=e("div",{class:"heading"},"Base:",-1)),e("div",Ue,[h(E,{wikitext:a.entry.Name},null,8,["wikitext"])])]),e("div",null,[t[5]||(t[5]=e("div",{class:"heading"},"System:",-1)),e("div",null,m(a.entry.System),1)]),e("div",null,[t[6]||(t[6]=e("div",{class:"heading"},"Platform:",-1)),e("div",null,m(a.entry.Platform),1)]),e("div",null,[t[7]||(t[7]=e("div",{class:"heading"},"Mode:",-1)),e("div",null,m(a.entry.Mode),1)]),e("div",null,[t[8]||(t[8]=e("div",{class:"heading"},"Arrival:",-1)),e("div",null,m(a.entry.CensusArrival.toLocaleDateString()),1)])]),e("details",null,[t[9]||(t[9]=e("summary",{role:"button"},"Actions",-1)),e("article",Te,[h(ue,{"user-object":a.entry,"data-tooltip":v.value,"button-text":"Renew","button-text-failed":"Failed!","button-text-success":"Renewed!"},null,8,["user-object","data-tooltip"]),e("button",{"data-tooltip":"Change Census Base",type:"button",onClick:y}," Change "),e("a",{href:`./form.html?update=${w(V)(a.entry.CensusPlayer)}`,"data-tooltip":"Update Census Base",role:"button",onClick:t[0]||(t[0]=e=>w(T)(a.entry))},"Update",8,Ve),h(j,{entry:a.entry,"data-tooltip":"New Census Base",text:"New"},null,8,["entry"])])])]),e("dialog",{ref_key:"changeBaseModal",ref:u,onClick:ne(p,["self"])},[r.value?(o(),L(Pe,{key:0,entry:a.entry,items:C.value,requested:n.value,onClose:p,onReady:g,onSubmit:b},null,8,["entry","items","requested"])):$("",!0)],512)],64))}}),We=M(Ae,[["__scopeId","data-v-fb23a3cc"]]),Fe={class:"layout-table"},je={class:"top-row"},ze=["value"],Oe={key:0,class:"census-items"},Je=P({__name:"CensusTable",setup(a){const t=ae(),{censusData:l,availableRevisions:s}=F(t),n=f(""),u=f(""),r=f([]),i=f(null);function d({Name:e,CensusPlayer:a,CensusDiscord:t,CensusReddit:l,Mode:s,Platform:r,System:o,CensusFriend:i,CensusRenewal:d}){return!(n.value&&!d.includes(n.value))&&[e,a,t,l,s,r,o,i].map((e=>e?.trim().toLowerCase())).some((e=>e?.includes(u.value.toLowerCase())))}A((()=>{const e=new URLSearchParams(window.location.search),a=e.get("name")??"";u.value=a;const t=e.get("rev");i.value=t})),le((()=>n.value=i.value??s.value[0]?.toString()));const v=S((()=>n.value?l.value.filter((e=>e.CensusRenewal.includes(n.value))):l.value)),y=S((()=>v.value.length)),p=S((()=>v.value.filter(d).toReversed())),C=e=>r.value=e;return(a,t)=>{const i=oe("search");return o(),c(R,null,[t[4]||(t[4]=e("h1",{class:"title"},"Eisvana Census Table",-1)),e("div",Fe,[e("div",je,[e("p",null,"Census count: "+m(y.value),1),h(i,{class:"search-wrapper"},{default:D((()=>[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),"aria-label":"Search Name",placeholder:"Search Player",type:"search"},null,512),[[W,u.value,void 0,{trim:!0}]])])),_:1}),e("div",null,[B(e("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),"aria-label":"Select Revision"},[t[2]||(t[2]=e("option",{value:""},"All",-1)),(o(!0),c(R,null,N(w(s),(e=>(o(),c("option",{value:e},m(e),9,ze)))),256))],512),[[re,n.value,void 0,{trim:!0}]])])]),t[3]||(t[3]=e("hr",null,null,-1)),h(ce,{data:p.value,"page-size":w(ve),onChange:C},null,8,["data","page-size"]),h(ie,null,{default:D((()=>[w(l).length?(o(),c("div",Oe,[(o(!0),c(R,null,N(r.value,(e=>(o(),L(We,{entry:e,key:e.CensusPlayer},null,8,["entry"])))),128))])):$("",!0)])),_:1})])],64)}}}),et=M(Je,[["__scopeId","data-v-ce1322fc"]]);export{et as default};
