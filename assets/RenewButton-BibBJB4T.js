import{d as p,r as n,o as _,c as g,a as t,t as v,B as b,a0 as x,s as S,G as k,m as O,F as D,a6 as N,_ as R}from"./main-mMslxVhu.js";import{r as w,b as j,d as B}from"./delay-Bd9wPkcC.js";const E=t("form",{method:"dialog",class:"close-button-wrapper"},[t("button",{"aria-label":"Close",class:"close"})],-1),$={class:"confirm-heading"},q={method:"dialog",class:"confirm-options"},F=t("button",{class:"secondary"},"No",-1),M=p({__name:"ConfirmDialog",props:{userName:{}},emits:["confirm"],setup(e,{expose:a,emit:s}){const o=n(null);return a({toggleModal:()=>{o.value?.showModal(),document.activeElement?.blur()}}),(e,a)=>(_(),g("dialog",{ref_key:"dialogElement",ref:o},[t("article",null,[t("header",null,[E,t("p",$,"Confirm renewal of "+v(e.userName)+"?",1)]),t("form",q,[t("button",{onClickOnce:a[0]||(a[0]=t=>e.$emit("confirm"))},"Yes",32),F])])],512))}});async function P(e){await fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:`${e.CensusPlayer} requested renewal.\n<${j(e.Name)}>`})})}const L=["aria-busy","disabled"],V=p({__name:"RenewButton",props:{userObject:{},buttonText:{},buttonTextFailed:{},buttonTextSuccess:{}},setup(e){const a=e,s=n(!1),o=n(!1),l=n(!1),u=b((()=>s.value?"":o.value?a.buttonTextFailed:l.value&&a.buttonTextSuccess?a.buttonTextSuccess:a.buttonText)),r=x(),{tries:c,requested:i,triesExceeded:d}=S(r),m=n(null),f=b((()=>d.value||a.userObject.renewRequested||a.userObject.renewed));async function p(){if(!w||f.value)return;const e=a.userObject.CensusPlayer;s.value=!0;try{await P(a.userObject),l.value=!0,a.userObject.renewRequested=!0,N(i,c,e)}catch(e){o.value=!0,console.warn(e)}finally{s.value=!1,setTimeout((()=>{l.value=!1,o.value=!1}),B)}}const y=()=>m.value?.toggleModal();return(e,a)=>(_(),g(D,null,[t("button",{"aria-busy":s.value,class:k([{"is-danger":o.value},"renew-button"]),disabled:f.value,type:"button",onClick:y},v(u.value),11,L),O(M,{"user-name":e.userObject.CensusPlayer,ref_key:"confirmDialog",ref:m,onConfirm:p},null,8,["user-name"])],64))}}),G=R(V,[["__scopeId","data-v-b8f437a9"]]);export{G as R};
