import{W as T,d as P,c,o as l,E as x,t as m,e as w,X as V,Y as A,r as y,M as W,l as G,m as K,n as Q,p as X,a as e,L as M,w as B,y as h,F as S,B as L,g as _,R as Z,G as H,C as ee,_ as E,Z as te,s as F,q as $,I as se,$ as ne,a0 as ae,i as le,a1 as oe,a2 as D,a3 as re,a4 as ie}from"./main-DPpLkC-k.js";import{R as ue,b as de,t as ce,P as ve}from"./Pagination-Dgxl9VpT.js";import{a as me,l as N}from"./censusSubmission-BqoCPbcA.js";import{a as ye}from"./delay-CVqJpmjZ.js";function fe(e){const a=e.slice(1,-1).split(" ");return{link:a[0],text:a.slice(1).join(" ")}}function ge(e){const a=e.slice(2,-2).split("|");return{link:`${T}${a[0]}`,text:a[1]}}function Ce(e){return e.startsWith("[http")?fe(e):e.startsWith("[[")?ge(e):{link:e,text:e}}const pe=["href"],U=P({__name:"LinkItem",props:{wikitext:{},text:{}},setup(e){const a=e,t=x(()=>a.wikitext.startsWith("[")?Ce(a.wikitext):{text:a.wikitext,link:`${T}${a.wikitext}`});return(a,s)=>(l(),c("a",{href:t.value.link,rel:"noopener noreferrer",target:"_blank"},m(e.text??t.value.text),9,pe))}}),he=["href"],j=P({__name:"NewBaseButton",props:{text:{},entry:{}},setup:e=>(a,t)=>(l(),c("a",{href:`./form.html?new=${w(A)(e.entry.CensusPlayer)}`,role:"button",onClick:t[0]||(t[0]=a=>w(V)(e.entry))},m(e.text),9,he))}),we={class:"text-bold"},be={key:0,class:"text-center"},ke={class:"base-item"},xe=["for","aria-disabled"],Se=["disabled","id","value"],Re=["href"],$e={key:3},Be=P({__name:"ChangeCensusBase",props:{entry:{},items:{},requested:{}},emits:["close","ready","submit"],setup(a,{emit:t}){const s=a,n=x(()=>s.requested===s.entry.Name?"":s.requested),u=x(()=>s.requested??s.entry.Name),r=y(s.items??[]),i=y(!1),o=y(u.value),d=y(""),v=t;function p(){o.value!==u.value&&(v("submit",o.value),me(s.entry,o.value,d.value))}return W(async()=>{if(!r.value.length)try{const e=await G(K(s.entry.CensusPlayer,Q));if(!X(e))return void(i.value=!0);r.value=e.cargoquery.map(e=>e.title.Name),v("ready",r.value),i.value=!1}catch(e){i.value=!0,console.error("Something went wrong:",e)}}),(t,s)=>(l(),c("article",null,[e("header",we,[s[3]||(s[3]=e("button",{"aria-label":"Close",class:"close",form:"request-close-form"},null,-1)),e("p",null,"Change Census Base for "+m(a.entry.CensusPlayer),1)]),1===r.value.length?(l(),c("div",be,[s[4]||(s[4]=e("p",null,"There's currently only one base on the wiki.",-1)),h(j,{entry:a.entry,text:"Create New Base"},null,8,["entry"])])):r.value.length?(l(),c(S,{key:1},[(l(!0),c(S,null,L(r.value,a=>(l(),c("div",ke,[e("label",{for:a,"aria-disabled":a===n.value||a===u.value&&!n.value,class:"base-selector"},[B(e("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>o.value=e),disabled:a===n.value||a===u.value&&!n.value,id:a,value:a,name:"bases",type:"radio"},null,8,Se),[[ee,o.value]]),e("span",null,m(a)+" "+m(a===n.value?"[Requested]":"")+" "+m(a!==u.value||n.value?"":"[Active]"),1)],8,xe),e("a",{href:w(ye)(a),rel:"noopener noreferrer",target:"_blank"},"View Wiki Page",8,Re)]))),256)),B(e("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>d.value=e),"aria-label":"Reason (optional)",class:"reason-input",placeholder:"Reason (optional)",type:"text"},null,512),[[_,d.value]])],64)):i.value?(l(),c("p",$e,"Something went wrong!")):(l(),M(Z,{key:2})),B(e("footer",null,[e("form",{id:"request-close-form",method:"dialog",onSubmit:s[2]||(s[2]=e=>t.$emit("close"))},[e("button",{onClick:p},"Submit"),s[5]||(s[5]=e("button",{class:"secondary"},"Cancel",-1))],32)],512),[[H,r.value.length>1]])]))}}),Pe=E(Be,[["__scopeId","data-v-39f3fe2d"]]),qe={class:"census-item"},Ne={class:"player-name text-bold"},Le={class:"table-items"},Me={key:0},Ee={key:1},Ie={class:"link is-social"},De={key:2},Ue={class:"friend-code"},Te={class:"link"},Ve={class:"action-buttons"},Ae=["href"],We=P({__name:"CensusItem",props:{entry:{}},setup(a){const t=a,s=localStorage.getItem(N)??"{}",n=JSON.parse(s),u=y(n[t.entry.CensusPlayer]);u.value===t.entry.Name&&(delete n[t.entry.CensusPlayer],localStorage.setItem(N,JSON.stringify(n)));const r=y(null),i=y(!1),o=te(),{triesExceeded:d}=F(o),v=x(()=>t.entry.renewed?"Already renewed":t.entry.renewRequested?"Renewal Requested":d.value?"Too Many Requests":`Request Renewal for ${ne}`),p=()=>{de(),i.value=!0,r.value?.showModal()},f=()=>{r.value?.close(),i.value=!1},C=y(),b=e=>C.value=e;function g(e){u.value=e,n[t.entry.CensusPlayer]=e,localStorage.setItem(N,JSON.stringify(n))}return(t,s)=>(l(),c(S,null,[e("article",qe,[e("p",Ne,m(a.entry.CensusPlayer),1),e("div",Le,[a.entry.CensusDiscord?(l(),c("div",Me,[s[1]||(s[1]=e("div",{class:"heading"},"Discord:",-1)),e("div",null,m(a.entry.CensusDiscord),1)])):$("",!0),a.entry.CensusReddit?(l(),c("div",Ee,[s[2]||(s[2]=e("div",{class:"heading"},"Social Media:",-1)),e("div",Ie,[h(U,{wikitext:a.entry.CensusReddit},null,8,["wikitext"])])])):$("",!0),a.entry.CensusFriend?(l(),c("div",De,[s[3]||(s[3]=e("div",{class:"heading"},"Friend Code:",-1)),e("div",Ue,m(a.entry.CensusFriend),1)])):$("",!0),e("div",null,[s[4]||(s[4]=e("div",{class:"heading"},"Base:",-1)),e("div",Te,[h(U,{wikitext:a.entry.Name},null,8,["wikitext"])])]),e("div",null,[s[5]||(s[5]=e("div",{class:"heading"},"System:",-1)),e("div",null,m(a.entry.System),1)]),e("div",null,[s[6]||(s[6]=e("div",{class:"heading"},"Platform:",-1)),e("div",null,m(a.entry.Platform),1)]),e("div",null,[s[7]||(s[7]=e("div",{class:"heading"},"Mode:",-1)),e("div",null,m(a.entry.Mode),1)]),e("div",null,[s[8]||(s[8]=e("div",{class:"heading"},"Arrival:",-1)),e("div",null,m(a.entry.CensusArrival.toLocaleDateString()),1)])]),e("details",null,[s[9]||(s[9]=e("summary",{role:"button"},"Actions",-1)),e("article",Ve,[h(ue,{"user-object":a.entry,"data-tooltip":v.value,"button-text":"Renew","button-text-failed":"Failed!","button-text-success":"Renewed!"},null,8,["user-object","data-tooltip"]),e("button",{"data-tooltip":"Change Census Base",type:"button",onClick:p}," Change "),e("a",{href:`./form.html?update=${w(A)(a.entry.CensusPlayer)}`,"data-tooltip":"Update Census Base",role:"button",onClick:s[0]||(s[0]=e=>w(V)(a.entry))},"Update",8,Ae),h(j,{entry:a.entry,"data-tooltip":"New Census Base",text:"New"},null,8,["entry"])])])]),e("dialog",{ref_key:"changeBaseModal",ref:r,onClick:se(f,["self"])},[i.value?(l(),M(Pe,{key:0,entry:a.entry,items:C.value,requested:u.value,onClose:f,onReady:b,onSubmit:g},null,8,["entry","items","requested"])):$("",!0)],512)],64))}}),_e=E(We,[["__scopeId","data-v-fb23a3cc"]]),Fe={class:"layout-table"},je={class:"top-row"},ze=["value"],Oe={key:0,class:"census-items"},Je=P({__name:"CensusTable",setup(a){const t=ae(),{censusData:s,availableRevisions:n}=F(t),u=y(""),r=y(""),i=y([]),o=y(null);function d({Name:e,CensusPlayer:a,CensusDiscord:l,CensusReddit:t,Mode:s,Platform:n,System:i,CensusFriend:o,CensusRenewal:d}){return!(u.value&&!d.includes(u.value))&&[e,a,l,t,s,n,i,o].map(e=>e?.trim().toLowerCase()).some(e=>e?.includes(r.value.toLowerCase()))}W(()=>{const e=new URLSearchParams(window.location.search),a=e.get("name")??"";r.value=a;const l=e.get("rev");o.value=l}),le(()=>u.value=o.value??n.value[0]?.toString());const v=x(()=>u.value?s.value.filter(e=>e.CensusRenewal.includes(u.value)):s.value),p=x(()=>v.value.length),f=x(()=>v.value.filter(d).toReversed()),C=e=>i.value=e;return(a,t)=>{const o=oe("search");return l(),c(S,null,[t[4]||(t[4]=e("h1",{class:"title"},"Eisvana Census Table",-1)),e("div",Fe,[e("div",je,[e("p",null,"Census count: "+m(p.value),1),h(o,{class:"search-wrapper"},{default:D(()=>[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),"aria-label":"Search Name",placeholder:"Search Player",type:"search"},null,512),[[_,r.value,void 0,{trim:!0}]])]),_:1}),e("div",null,[B(e("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),"aria-label":"Select Revision"},[t[2]||(t[2]=e("option",{value:""},"All",-1)),(l(!0),c(S,null,L(w(n),e=>(l(),c("option",{value:e},m(e),9,ze))),256))],512),[[re,u.value,void 0,{trim:!0}]])])]),t[3]||(t[3]=e("hr",null,null,-1)),h(ve,{data:f.value,"page-size":w(ce),onChange:C},null,8,["data","page-size"]),h(ie,null,{default:D(()=>[w(s).length?(l(),c("div",Oe,[(l(!0),c(S,null,L(i.value,e=>(l(),M(_e,{entry:e,key:e.CensusPlayer},null,8,["entry"]))),128))])):$("",!0)]),_:1})])],64)}}}),et=E(Je,[["__scopeId","data-v-ce1322fc"]]);export{et as default};
