import{U as W,d as P,B as w,o as l,c as d,t as p,e as C,V as F,W as z,r as _,K as X,X as Z,Y as G,Z as H,$ as ee,a as e,m as b,F as S,x as N,w as B,g as J,J as E,P as te,E as se,z as M,A as L,y as ae,_ as D,a0 as ne,s as O,a1 as oe,k as R,I as le,a2 as re,i as ie,a3 as ue,a4 as de,a5 as ce}from"./main-D5p7ffbv.js";import{R as ve,b as pe,t as ye,P as he}from"./Pagination-Bd_2gjxu.js";import{a as _e,l as q}from"./censusSubmission-CjfIyr_9.js";import{a as me}from"./delay-CXW0bzkw.js";function fe(e){const a=e.slice(1,-1).split(" ");return{link:a[0],text:a[1]}}function ge(e){const a=e.slice(2,-2).split("|");return{link:`${W}${a[0]}`,text:a[1]}}function Ce(e){return e.startsWith("[http")?fe(e):e.startsWith("[[")?ge(e):{link:e,text:e}}const be=["href"],A=P({__name:"LinkItem",props:{wikitext:{},text:{}},setup(e){const a=e,t=w((()=>a.wikitext.startsWith("[")?Ce(a.wikitext):{text:a.wikitext,link:`${W}${a.wikitext}`}));return(e,a)=>(l(),d("a",{href:t.value.link,rel:"noopener noreferrer",target:"_blank"},p(e.text??t.value.text),9,be))}}),we=["href"],j=P({__name:"NewBaseButton",props:{text:{},entry:{}},setup:e=>(e,a)=>(l(),d("a",{href:`./form.html?new=${C(F)(e.entry.CensusPlayer)}`,role:"button",onClick:a[0]||(a[0]=a=>C(z)(e.entry))},p(e.text),9,we))}),U=e=>(M("data-v-86e0768b"),e=e(),L(),e),ke={class:"text-bold"},Se=U((()=>e("button",{"aria-label":"Close",class:"close",form:"request-close-form"},null,-1))),$e={key:0,class:"text-center"},Re=U((()=>e("p",null,"There's currently only one base on the wiki.",-1))),Be={class:"base-item"},Pe=["for","aria-disabled"],xe=["disabled","id","value"],Ie=["href"],qe={key:3},Ne=U((()=>e("button",{class:"secondary"},"Cancel",-1))),Ee=P({__name:"ChangeCensusBase",props:{entry:{},items:{},requested:{}},emits:["close","ready","submit"],setup(a,{emit:t}){const s=a,n=w((()=>s.requested===s.entry.Name?"":s.requested)),u=w((()=>s.requested??s.entry.Name)),r=_(s.items??[]),i=_(!1),o=_(u.value),v=_(""),c=t;function y(){o.value!==u.value&&(c("submit",o.value),_e(s.entry,o.value,v.value))}return X((async()=>{if(!r.value.length)try{const e=await Z(G(s.entry.CensusPlayer,H));if(!ee(e))return void(i.value=!0);r.value=e.cargoquery.map((e=>e.title.Name)),c("ready",r.value),i.value=!1}catch(e){i.value=!0,console.error("Something went wrong:",e)}})),(a,t)=>(l(),d("article",null,[e("header",ke,[Se,e("p",null,"Change Census Base for "+p(a.entry.CensusPlayer),1)]),1===r.value.length?(l(),d("div",$e,[Re,b(j,{entry:a.entry,text:"Create New Base"},null,8,["entry"])])):r.value.length?(l(),d(S,{key:1},[(l(!0),d(S,null,N(r.value,(a=>(l(),d("div",Be,[e("label",{for:a,"aria-disabled":a===n.value||a===u.value&&!n.value,class:"base-selector"},[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),disabled:a===n.value||a===u.value&&!n.value,id:a,value:a,name:"bases",type:"radio"},null,8,xe),[[ae,o.value]]),e("span",null,p(a)+" "+p(a===n.value?"[Requested]":"")+" "+p(a!==u.value||n.value?"":"[Active]"),1)],8,Pe),e("a",{href:C(me)(a),rel:"noopener noreferrer",target:"_blank"},"View Wiki Page",8,Ie)])))),256)),B(e("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),"aria-label":"Reason",class:"reason-input",placeholder:"Reason",type:"text"},null,512),[[J,v.value]])],64)):i.value?(l(),d("p",qe,"Something went wrong!")):(l(),E(te,{key:2})),B(e("footer",null,[e("form",{id:"request-close-form",method:"dialog",onSubmit:t[2]||(t[2]=e=>a.$emit("close"))},[e("button",{onClick:y},"Submit"),Ne],32)],512),[[se,r.value.length>1]])]))}}),Me=D(Ee,[["__scopeId","data-v-86e0768b"]]),f=e=>(M("data-v-78f2e0c4"),e=e(),L(),e),Le={class:"census-item"},De={class:"player-name text-bold"},Ue={class:"table-items"},Te={key:0},Ve=f((()=>e("div",{class:"heading"},"Discord:",-1))),Ae={key:1},We=f((()=>e("div",{class:"heading"},"Social Media:",-1))),Fe={class:"link is-social"},ze={key:2},Je=f((()=>e("div",{class:"heading"},"Friend Code:",-1))),Oe={class:"friend-code"},je=f((()=>e("div",{class:"heading"},"Base:",-1))),Ke={class:"link"},Ye=f((()=>e("div",{class:"heading"},"System:",-1))),Qe=f((()=>e("div",{class:"heading"},"Platform:",-1))),Xe=f((()=>e("div",{class:"heading"},"Mode:",-1))),Ze=f((()=>e("div",{class:"heading"},"Arrival:",-1))),Ge=f((()=>e("summary",{role:"button"},"Actions",-1))),He={class:"action-buttons"},et=["href"],tt=P({__name:"CensusItem",props:{entry:{}},setup(a){const t=a,s=localStorage.getItem(q)??"{}",n=JSON.parse(s),u=_(n[t.entry.CensusPlayer]);u.value===t.entry.Name&&(delete n[t.entry.CensusPlayer],localStorage.setItem(q,JSON.stringify(n)));const r=_(null),i=_(!1),o=ne(),{triesExceeded:v}=O(o),c=w((()=>t.entry.renewed?"Already renewed":t.entry.renewRequested?"Renewal Requested":v.value?"Too Many Requests":`Request Renewal for ${oe}`)),y=()=>{pe(),i.value=!0,r.value?.showModal()},m=()=>{r.value?.close(),i.value=!1},f=_(),h=e=>f.value=e;function g(e){u.value=e,n[t.entry.CensusPlayer]=e,localStorage.setItem(q,JSON.stringify(n))}return(a,t)=>(l(),d(S,null,[e("article",Le,[e("p",De,p(a.entry.CensusPlayer),1),e("div",Ue,[a.entry.CensusDiscord?(l(),d("div",Te,[Ve,e("div",null,p(a.entry.CensusDiscord),1)])):R("",!0),a.entry.CensusReddit?(l(),d("div",Ae,[We,e("div",Fe,[b(A,{wikitext:a.entry.CensusReddit},null,8,["wikitext"])])])):R("",!0),a.entry.CensusFriend?(l(),d("div",ze,[Je,e("div",Oe,p(a.entry.CensusFriend),1)])):R("",!0),e("div",null,[je,e("div",Ke,[b(A,{wikitext:a.entry.Name},null,8,["wikitext"])])]),e("div",null,[Ye,e("div",null,p(a.entry.System),1)]),e("div",null,[Qe,e("div",null,p(a.entry.Platform),1)]),e("div",null,[Xe,e("div",null,p(a.entry.Mode),1)]),e("div",null,[Ze,e("div",null,p(a.entry.CensusArrival.toLocaleDateString()),1)])]),e("details",null,[Ge,e("article",He,[b(ve,{"user-object":a.entry,"data-tooltip":c.value,"button-text":"Renew","button-text-failed":"Failed!","button-text-success":"Renewed!"},null,8,["user-object","data-tooltip"]),e("button",{"data-tooltip":"Change Census Base",type:"button",onClick:y}," Change "),e("a",{href:`./form.html?update=${C(F)(a.entry.CensusPlayer)}`,"data-tooltip":"Update Census Base",role:"button",onClick:t[0]||(t[0]=e=>C(z)(a.entry))},"Update",8,et),b(j,{entry:a.entry,"data-tooltip":"New Census Base",text:"New"},null,8,["entry"])])])]),e("dialog",{ref_key:"changeBaseModal",ref:r,onClick:le(m,["self"])},[i.value?(l(),E(Me,{key:0,entry:a.entry,items:f.value,requested:u.value,onClose:m,onReady:h,onSubmit:g},null,8,["entry","items","requested"])):R("",!0)],512)],64))}}),st=D(tt,[["__scopeId","data-v-78f2e0c4"]]),T=e=>(M("data-v-380b9ef2"),e=e(),L(),e),at=T((()=>e("h1",{class:"title"},"Eisvana Census Table",-1))),nt={class:"layout-table"},ot={class:"top-row"},lt={class:"search-wrapper"},rt=T((()=>e("option",{value:""},"All",-1))),it=["value"],ut=T((()=>e("hr",null,null,-1))),dt={key:0,class:"census-items"},ct=P({__name:"CensusTable",setup(a){const t=re(),{censusData:s,availableRevisions:n}=O(t),u=_(""),r=_(""),i=_([]);function o({Name:e,CensusPlayer:a,CensusDiscord:t,CensusReddit:l,Mode:s,Platform:n,System:i,CensusFriend:o,CensusRenewal:d}){return!(u.value&&!d.includes(u.value))&&[e,a,t,l,s,n,i,o].map((e=>e?.trim().toLowerCase())).some((e=>e?.includes(r.value.toLowerCase())))}ie((()=>u.value=n.value[0]?.toString()));const v=w((()=>u.value?s.value.filter((e=>e.CensusRenewal.includes(u.value))):s.value)),c=w((()=>v.value.length)),y=w((()=>v.value.filter(o).toReversed())),m=e=>i.value=e;return(a,t)=>(l(),d(S,null,[at,e("div",nt,[e("div",ot,[e("p",null,"Census count: "+p(c.value),1),e("div",lt,[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),"aria-label":"Search Name",placeholder:"Search Player",type:"search"},null,512),[[J,r.value,void 0,{trim:!0}]])]),e("div",null,[B(e("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),"aria-label":"Select Revision"},[rt,(l(!0),d(S,null,N(C(n),(e=>(l(),d("option",{value:e},p(e),9,it)))),256))],512),[[ue,u.value,void 0,{trim:!0}]])])]),ut,b(he,{data:y.value,"page-size":C(ye),onChange:m},null,8,["data","page-size"]),b(ce,null,{default:de((()=>[C(s).length?(l(),d("div",dt,[(l(!0),d(S,null,N(i.value,(e=>(l(),E(st,{entry:e,key:e.CensusPlayer},null,8,["entry"])))),128))])):R("",!0)])),_:1})])],64))}}),gt=D(ct,[["__scopeId","data-v-380b9ef2"]]);export{gt as default};
