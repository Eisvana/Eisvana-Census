import{W as T,d as P,D as k,o as r,c as v,t as p,e as w,X as U,Y as V,r as f,M as A,p as K,q as Y,y as H,x as Q,a as e,m as h,F as R,B as N,w as B,g as W,L,R as X,H as Z,C as G,_ as M,Z as ee,s as F,$ as te,k as $,K as se,a0 as ne,i as ae,a1 as le,a2 as E,a3 as oe,a4 as re}from"./main-CZkiOGpC.js";import{R as ie,b as ue,t as de,P as ve}from"./Pagination-Wk4M9JSt.js";import{a as ce,l as q}from"./censusSubmission-BrrzwUqL.js";import{a as pe}from"./delay-DaK10uQ6.js";function me(e){const a=e.slice(1,-1).split(" ");return{link:a[0],text:a.slice(1).join(" ")}}function ye(e){const a=e.slice(2,-2).split("|");return{link:`${T}${a[0]}`,text:a[1]}}function fe(e){return e.startsWith("[http")?me(e):e.startsWith("[[")?ye(e):{link:e,text:e}}const Ce=["href"],I=P({__name:"LinkItem",props:{wikitext:{},text:{}},setup(e){const a=e,t=k((()=>a.wikitext.startsWith("[")?fe(a.wikitext):{text:a.wikitext,link:`${T}${a.wikitext}`}));return(e,a)=>(r(),v("a",{href:t.value.link,rel:"noopener noreferrer",target:"_blank"},p(e.text??t.value.text),9,Ce))}}),ge=["href"],j=P({__name:"NewBaseButton",props:{text:{},entry:{}},setup:e=>(e,a)=>(r(),v("a",{href:`./form.html?new=${w(U)(e.entry.CensusPlayer)}`,role:"button",onClick:a[0]||(a[0]=a=>w(V)(e.entry))},p(e.text),9,ge))}),he={class:"text-bold"},we={key:0,class:"text-center"},be={class:"base-item"},ke=["for","aria-disabled"],Se=["disabled","id","value"],Re=["href"],_e={key:3},$e=P({__name:"ChangeCensusBase",props:{entry:{},items:{},requested:{}},emits:["close","ready","submit"],setup(a,{emit:t}){const l=a,s=k((()=>l.requested===l.entry.Name?"":l.requested)),n=k((()=>l.requested??l.entry.Name)),u=f(l.items??[]),i=f(!1),o=f(n.value),d=f(""),c=t;function y(){o.value!==n.value&&(c("submit",o.value),ce(l.entry,o.value,d.value))}return A((async()=>{if(!u.value.length)try{const e=await K(Y(l.entry.CensusPlayer,H));if(!Q(e))return void(i.value=!0);u.value=e.cargoquery.map((e=>e.title.Name)),c("ready",u.value),i.value=!1}catch(e){i.value=!0,console.error("Something went wrong:",e)}})),(a,t)=>(r(),v("article",null,[e("header",he,[t[3]||(t[3]=e("button",{"aria-label":"Close",class:"close",form:"request-close-form"},null,-1)),e("p",null,"Change Census Base for "+p(a.entry.CensusPlayer),1)]),1===u.value.length?(r(),v("div",we,[t[4]||(t[4]=e("p",null,"There's currently only one base on the wiki.",-1)),h(j,{entry:a.entry,text:"Create New Base"},null,8,["entry"])])):u.value.length?(r(),v(R,{key:1},[(r(!0),v(R,null,N(u.value,(a=>(r(),v("div",be,[e("label",{for:a,"aria-disabled":a===s.value||a===n.value&&!s.value,class:"base-selector"},[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),disabled:a===s.value||a===n.value&&!s.value,id:a,value:a,name:"bases",type:"radio"},null,8,Se),[[G,o.value]]),e("span",null,p(a)+" "+p(a===s.value?"[Requested]":"")+" "+p(a!==n.value||s.value?"":"[Active]"),1)],8,ke),e("a",{href:w(pe)(a),rel:"noopener noreferrer",target:"_blank"},"View Wiki Page",8,Re)])))),256)),B(e("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),"aria-label":"Reason (optional)",class:"reason-input",placeholder:"Reason (optional)",type:"text"},null,512),[[W,d.value]])],64)):i.value?(r(),v("p",_e,"Something went wrong!")):(r(),L(X,{key:2})),B(e("footer",null,[e("form",{id:"request-close-form",method:"dialog",onSubmit:t[2]||(t[2]=e=>a.$emit("close"))},[e("button",{onClick:y},"Submit"),t[5]||(t[5]=e("button",{class:"secondary"},"Cancel",-1))],32)],512),[[Z,u.value.length>1]])]))}}),Be=M($e,[["__scopeId","data-v-39f3fe2d"]]),Pe={class:"census-item"},xe={class:"player-name text-bold"},qe={class:"table-items"},Ne={key:0},Le={key:1},Me={class:"link is-social"},De={key:2},Ee={class:"friend-code"},Ie={class:"link"},Te={class:"action-buttons"},Ue=["href"],Ve=P({__name:"CensusItem",props:{entry:{}},setup(a){const t=a,l=localStorage.getItem(q)??"{}",s=JSON.parse(l),n=f(s[t.entry.CensusPlayer]);n.value===t.entry.Name&&(delete s[t.entry.CensusPlayer],localStorage.setItem(q,JSON.stringify(s)));const u=f(null),i=f(!1),o=ee(),{triesExceeded:d}=F(o),c=k((()=>t.entry.renewed?"Already renewed":t.entry.renewRequested?"Renewal Requested":d.value?"Too Many Requests":`Request Renewal for ${te}`)),y=()=>{ue(),i.value=!0,u.value?.showModal()},m=()=>{u.value?.close(),i.value=!1},C=f(),b=e=>C.value=e;function g(e){n.value=e,s[t.entry.CensusPlayer]=e,localStorage.setItem(q,JSON.stringify(s))}return(a,t)=>(r(),v(R,null,[e("article",Pe,[e("p",xe,p(a.entry.CensusPlayer),1),e("div",qe,[a.entry.CensusDiscord?(r(),v("div",Ne,[t[1]||(t[1]=e("div",{class:"heading"},"Discord:",-1)),e("div",null,p(a.entry.CensusDiscord),1)])):$("",!0),a.entry.CensusReddit?(r(),v("div",Le,[t[2]||(t[2]=e("div",{class:"heading"},"Social Media:",-1)),e("div",Me,[h(I,{wikitext:a.entry.CensusReddit},null,8,["wikitext"])])])):$("",!0),a.entry.CensusFriend?(r(),v("div",De,[t[3]||(t[3]=e("div",{class:"heading"},"Friend Code:",-1)),e("div",Ee,p(a.entry.CensusFriend),1)])):$("",!0),e("div",null,[t[4]||(t[4]=e("div",{class:"heading"},"Base:",-1)),e("div",Ie,[h(I,{wikitext:a.entry.Name},null,8,["wikitext"])])]),e("div",null,[t[5]||(t[5]=e("div",{class:"heading"},"System:",-1)),e("div",null,p(a.entry.System),1)]),e("div",null,[t[6]||(t[6]=e("div",{class:"heading"},"Platform:",-1)),e("div",null,p(a.entry.Platform),1)]),e("div",null,[t[7]||(t[7]=e("div",{class:"heading"},"Mode:",-1)),e("div",null,p(a.entry.Mode),1)]),e("div",null,[t[8]||(t[8]=e("div",{class:"heading"},"Arrival:",-1)),e("div",null,p(a.entry.CensusArrival.toLocaleDateString()),1)])]),e("details",null,[t[9]||(t[9]=e("summary",{role:"button"},"Actions",-1)),e("article",Te,[h(ie,{"user-object":a.entry,"data-tooltip":c.value,"button-text":"Renew","button-text-failed":"Failed!","button-text-success":"Renewed!"},null,8,["user-object","data-tooltip"]),e("button",{"data-tooltip":"Change Census Base",type:"button",onClick:y}," Change "),e("a",{href:`./form.html?update=${w(U)(a.entry.CensusPlayer)}`,"data-tooltip":"Update Census Base",role:"button",onClick:t[0]||(t[0]=e=>w(V)(a.entry))},"Update",8,Ue),h(j,{entry:a.entry,"data-tooltip":"New Census Base",text:"New"},null,8,["entry"])])])]),e("dialog",{ref_key:"changeBaseModal",ref:u,onClick:se(m,["self"])},[i.value?(r(),L(Be,{key:0,entry:a.entry,items:C.value,requested:n.value,onClose:m,onReady:b,onSubmit:g},null,8,["entry","items","requested"])):$("",!0)],512)],64))}}),Ae=M(Ve,[["__scopeId","data-v-fb23a3cc"]]),We={class:"layout-table"},Fe={class:"top-row"},je=["value"],ze={key:0,class:"census-items"},Oe=P({__name:"CensusTable",setup(a){const t=ne(),{censusData:l,availableRevisions:s}=F(t),n=f(""),u=f(""),i=f([]);function o({Name:e,CensusPlayer:a,CensusDiscord:t,CensusReddit:l,Mode:s,Platform:r,System:i,CensusFriend:o,CensusRenewal:d}){return!(n.value&&!d.includes(n.value))&&[e,a,t,l,s,r,i,o].map((e=>e?.trim().toLowerCase())).some((e=>e?.includes(u.value.toLowerCase())))}A((()=>{const e=new URLSearchParams(window.location.search).get("name")??"";u.value||=e})),ae((()=>n.value=s.value[0]?.toString()));const d=k((()=>n.value?l.value.filter((e=>e.CensusRenewal.includes(n.value))):l.value)),c=k((()=>d.value.length)),y=k((()=>d.value.filter(o).toReversed())),m=e=>i.value=e;return(a,t)=>{const o=le("search");return r(),v(R,null,[t[4]||(t[4]=e("h1",{class:"title"},"Eisvana Census Table",-1)),e("div",We,[e("div",Fe,[e("p",null,"Census count: "+p(c.value),1),h(o,{class:"search-wrapper"},{default:E((()=>[B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),"aria-label":"Search Name",placeholder:"Search Player",type:"search"},null,512),[[W,u.value,void 0,{trim:!0}]])])),_:1}),e("div",null,[B(e("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),"aria-label":"Select Revision"},[t[2]||(t[2]=e("option",{value:""},"All",-1)),(r(!0),v(R,null,N(w(s),(e=>(r(),v("option",{value:e},p(e),9,je)))),256))],512),[[oe,n.value,void 0,{trim:!0}]])])]),t[3]||(t[3]=e("hr",null,null,-1)),h(ve,{data:y.value,"page-size":w(de),onChange:m},null,8,["data","page-size"]),h(re,null,{default:E((()=>[w(l).length?(r(),v("div",ze,[(r(!0),v(R,null,N(i.value,(e=>(r(),L(Ae,{entry:e,key:e.CensusPlayer},null,8,["entry"])))),128))])):$("",!0)])),_:1})])],64)}}}),Ge=M(Oe,[["__scopeId","data-v-29f1a2d1"]]);export{Ge as default};
